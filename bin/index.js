#!/usr/bin/env node
import N from"path";import{fileURLToPath as Z}from"url";var H=Z(import.meta.url),K=N.dirname(H),X=process.env.npm_lifecycle_event==="dev",d=process.cwd(),ee=N.join(K,X?"../src":"../bin"),C=N.join(ee,"templates"),J=["     ____  __________  _____    __    __   ______ ","    / __ / ____/ __ / // /|  / / /   |  / / __   /","   / / / / __/ / /_/ // / | | / /____| | / /__/ / ","  / /_/ / /___/ _, _// /  | |/ /_____/ |/ // __/  "," /_____/_____/_/ |_/___/  |___/      |___//____/  "].join(`
`);import $ from"fs-extra";import R from"path";import T from"chalk";var g=e=>console.log(T.cyan(e)),f=e=>console.log(T.red(e));var z=e=>{let t=R.join(d,e);$.existsSync(t)?(f(`The package ${e} already exists!`),process.exit(1)):$.mkdirSync(R.join(d,e))};import*as n from"@clack/prompts";import te from"fs-extra";import re from"path";var ie=e=>{if(!e.length)return"A package name is required";if(te.existsSync(re.join(d,e)))return`The package folder ${e} already exists`},B=async()=>{let e=await n.text({message:"What is the name of the new V2 package?",validate:ie});if(await n.confirm({message:"Is this for a library?",initialValue:!1})){let p=await n.text({message:"Provide a short description of the library",validate(x){if(x.length===0)return"A description is required"}}),c=await n.text({message:"Provide the Github organization name owning this library",initialValue:"deriv-com"}),h=await n.text({message:`Provide the Github repository name for the library (found at https://github.com/${c.toString()}/<REPOSITORY_NAME>)`,validate(x){if(x.length===0)return"A repository name is required";if(/[A-Z]/.test(x))return"Repository name should not contain uppercases"}}),Q=`https://github.com/${c}/${e.toString()}`,Y=await n.confirm({message:"Should we initialize a Git repository and bootstrap the package?",initialValue:!0});return{name:e.toString(),description:p.toString(),repository:Q.toString(),organizationName:c.toString(),repositoryName:h.toString(),type:"library",shouldBootstrap:!!Y}}let r=await n.group({bundler:()=>n.select({message:"Which bundler would you like to integrate?",options:[{value:"vite",label:"Vite"},{value:"rsbuild",label:"Rsbuild"}],initialValue:"webpack"}),styling:()=>n.select({message:"Which styling library will you be using?",options:[{value:"tailwind",label:"Tailwind",hint:"includes twMerge and clsx"},{value:"sass",label:"Sass",hint:"includes clsx"},{value:"styledComponents",label:"Styled Components"}],initialValue:"tailwind"}),derivPackages:()=>n.multiselect({message:"Which Deriv packages should be included?",options:[{value:"derivUi",label:"@deriv/ui"},{value:"derivUtils",label:"@deriv/utils"},{value:"derivIcons",label:"@deriv/quill-icons"}]})},{onCancel:()=>process.exit(1)}),i=await n.confirm({message:"Do you want to configure the folder structure?",initialValue:!0}),s;i&&(s=await n.multiselect({message:"Which folder structures should we bootstrap for you?",options:[{value:"components",label:"components",hint:"at src/components"},{value:"pages",label:"pages",hint:"at src/pages"},{value:"screens",label:"screens",hint:"at src/screens"},{value:"hooks",label:"hooks",hint:"at src/hooks"},{value:"utils",label:"utils",hint:"at src/utils"}]}));let l,m=await n.confirm({message:"Should we initialize a Git repository and bootstrap the package?",initialValue:!0});return{name:e.toString(),type:"package",...r,shouldBootstrap:!!m,aliases:l,folders:s}};import L from"fs-extra";import{join as oe}from"path";var o=({packagePath:e,dependencies:t,devDependencies:r,scripts:i,name:s,description:l,repositoryUrl:m})=>{let k=oe(e,"package.json"),p=L.readJSONSync(k);if(t)for(let[c,h]of Object.entries(t))p.dependencies[c]=h;if(r)for(let[c,h]of Object.entries(r))p.devDependencies[c]=h;i&&Object.keys(i).forEach(c=>p.scripts[c]=i[c]),s&&(p.name=s),l&&(p.description=l),m&&(p.repository={url:m},p.homepage=`${m}#readme`,p.bugs={url:`${m}/issues`}),L.writeJSONSync(k,p,{spaces:2})};import Re from"fs-extra";import{exec as ne}from"child_process";import se from"util";import{spinner as ae}from"@clack/prompts";var v=se.promisify(ne);async function P(e,t){let r=ae();try{r.start("Initializing Git repository"),await v(`cd ${e} && git init`),t.type==="library"&&await v(`git remote add upstream git@github.com:${t.organizationName}/${t.repositoryName}.git`),r.message("Bootstrapping dependencies (this might take some time \u{1F61B})"),await v(`cd ${e} && npm install`),r.message("Preparing precommit hooks"),await v(`cd ${e} && npm run prepare`),t.type==="library"&&(r.message("Setting up development branch for pre-release"),await v("git checkout -b development")),r.stop()}catch(i){console.log(i),r.stop("There was an error in bootstrapping the package")}}import{join as _}from"path";import j from"fs-extra";function a(e,t){let r=_(C,t),i=_(d,e)+"/";j.copySync(r,i,{overwrite:!0}),j.existsSync(_(i,"gitignore"))&&j.renameSync(_(i,"gitignore"),_(i,".gitignore"))}var u=(e,t)=>{a(e,t?"libraryLinters":"linters"),o({packagePath:e,devDependencies:t?{"@deriv-com/eslint-config-deriv":"^2.1.0-beta.3","eslint-plugin-prettier":"^5.0.0",prettier:"^3.1.0"}:{"@deriv-com/eslint-config-deriv":"^2.1.0-beta.3","eslint-plugin-prettier":"^5.0.0",stylelint:"^13.13.1","stylelint-config-prettier":"^8.0.2","stylelint-formatter-pretty":"^2.1.1","stylelint-no-unsupported-browser-features":"^4.0.0","stylelint-selector-bem-pattern":"^2.1.0",prettier:"^3.1.0"},scripts:{"test:lint":'prettier --log-level silent --write . && eslint "./src/**/*.?(js|jsx|ts|tsx)"'}})};var y=e=>{o({packagePath:e,devDependencies:{"lint-staged":"^10.4.0",husky:"^7.0.0","@commitlint/cli":"^17.1.2","@commitlint/config-conventional":"^17.1.0","@commitlint/config-nx-scopes":"^17.0.0"},scripts:{prepare:"husky install"}}),a(e,"husky")};var S=e=>{o({packagePath:e,devDependencies:{jest:"^29.7.0","jest-environment-jsdom":"^29.7.0","jest-transformer-svg":"^2.0.2","@testing-library/jest-dom":"^6.4.2","@testing-library/react":"^14.2.1","@testing-library/user-event":"^14.5.2","@types/jest":"^29.5.12","identity-obj-proxy":"^3.0.0","ts-jest":"^29.1.2"}}),a(e,"jest")};var A=e=>{a(e,"rsbuild"),a(e,"actions"),u(e,!1),y(e),S(e),o({packagePath:e,name:e})};var E=e=>{o({packagePath:e,dependencies:{clsx:"^2.1.0"},devDependencies:{sass:"^1.70.0"}})};var V=e=>{o({packagePath:e,dependencies:{clsx:"^2.1.0","tailwind-merge":"^2.2.1"},devDependencies:{tailwindcss:"^3.3.5",autoprefixer:"^10.4.14",postcss:"^8.4.31",prettier:"^3.1.0","prettier-plugin-tailwindcss":"^0.5.7"}}),a(e,"tailwind")};import{parse as le}from"@babel/parser";import pe from"@babel/traverse";import ce from"@babel/generator";import D from"fs-extra";import{join as me}from"path";async function I({packagePath:e,organizationName:t}){let r=me(e,"release.config.cjs");if(!D.existsSync(r))throw new Error("release.config.cjs does not exist within the package folder.");let i=D.readFileSync(r,"utf-8"),s=await le(i);await pe.default(s,{ObjectProperty:function(m){m.node.key?.name==="repositoryUrl"&&(m.node.value.value=`git@github.com:${t}/${e}.git`)}});let l=await ce.default(s);D.writeFileSync(r,l.code,"utf-8")}var U=(e,t)=>{a(e,"tsup"),u(e,!0),y(e),I({packagePath:e,organizationName:t.organizationName}),o({packagePath:e,name:t.name,description:t.description,repositoryUrl:t.repository,devDependencies:{"@semantic-release/changelog":"^6.0.3","@semantic-release/github":"^9.2.6","@semantic-release/npm":"^11.0.3","@semantic-release/release-notes-generator":"^12.1.0"}})};var F=e=>{a(e,"vite"),a(e,"actions"),u(e,!1),y(e),S(e),o({packagePath:e,name:e})};var G=e=>{o({packagePath:e,dependencies:{"styled-components":"^6.1.8"}})};var de={derivUi:{dependency:"@deriv-com/ui",version:"latest"},derivUtils:{dependency:"@deriv-com/utils",version:"latest"},derivIcons:{dependency:"@deriv/quill-icons",version:"latest"}},q=(e,t)=>{let r={};for(let i=0;i<t.length;i++){let s=de[t[i]];r[s.dependency]=s.version}o({packagePath:e,dependencies:r})};import fe from"gradient-string";import b from"chalk";import O from"boxen";import{join as ge}from"path";import w from"fs-extra";var W=(e,t)=>{let r=ge(d,e);for(let i=0;i<t.length;i++){let s=`${r}/src/${t[i]}`;if(!w.existsSync(s)){w.mkdirSync(s);try{let l=w.openSync(`${s}/index.ts`,"wx");w.closeSync(l)}catch{continue}}}};var M=(e,t)=>{let r=s=>s.map(l=>b.bold("\u279C")+`  ${l}`).join(`
`),i=r(["git init","npm install","npm run prepare"]);g(b.bold(`Navigate to ${e} folder and run the following commands:`)),g(O(b.bold("\u279C")+`  cd ${e}
`+(t.shouldBootstrap?"":i),{padding:2,borderStyle:"none"})),g(b.bold("To start the development server:")),g(O(b.bold("\u279C")+"  npm run dev",{padding:2,borderStyle:"none"})),t.type==="library"&&(g(b.bold("To commit and publish for a pre-release version (e.g. 1.0.0-development.1):")),g(O(r(["git checkout -b development","git add .",'git commit -m "feat: initialized repository for library"',"git push upstream development"]),{padding:2,borderStyle:"none"})))},ue=async()=>{let e=fe("#b62020","#fe8181");console.log(e.multiline(J)),console.log(`
`);let t=await B(),r=String(t.name);if(z(r),t.type==="library"){U(r,t),t.shouldBootstrap&&await P(r,t),M(r,t);return}switch(t.bundler){case"vite":F(r);break;case"rsbuild":A(r);break;default:break}switch(t.styling){case"tailwind":V(r);break;case"sass":E(r);break;case"styledComponents":G(r);break;default:break}t.derivPackages.length&&q(r,t.derivPackages),t.folders&&W(r,t.folders),t.shouldBootstrap&&await P(r,t),M(r,t)};ue().catch(e=>{f("Aborting installation..."),e instanceof Error?f(e.message):(f("An unknown error has occurred:"),console.log(e)),process.exit(1)});
//# sourceMappingURL=index.js.map